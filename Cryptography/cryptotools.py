ENG_IC = 0.0686
ENG_LETTER_FREQ = [0.08167,0.01492,0.02782,0.04253,0.12702,0.02228,0.02015,0.06094,0.06966,0.00153,0.00772,0.04025,0.02406,0.06749,0.07507,0.01929,0.00095,0.05987,0.06327,0.09056,0.02758,0.00978,0.02360,0.00150,0.01974,0.00074,]
ALPHABET = [chr(97 + i) for i in range(0,26)]
TRIGRAM_ORDER = ["the", "and", "tha", "ent", "ing", "ion", "tio", "for", "nde", "has", "nce", "edt", "tis", "oft", "sth", "men"]
TRIGRAM_FREQUENCIES = [0.035,0.015,0.011,0.0082,0.0065,0.0059,0.0059,0.00560,0.0055,0.0053,0.005,0.0046,0.0046,0.0043,0.0043,0.0043]
BIGRAM_FREQ = {'th': 0.035562, 'he': 0.0307474, 'in': 0.0243275, 'er': 0.0204826, 'an': 0.0198515, 're': 0.0185432, 'on': 0.0175805, 'at': 0.0148673, 'en': 0.0145425, 'nd': 0.0135228, 'ti': 0.0134258, 'es': 0.0133939, 'or': 0.0127654, 'te': 0.0120487, 'of': 0.0117498, 'ed': 0.0116812, 'is': 0.0112843, 'it': 0.0112327, 'al': 0.0108745, 'ar': 0.010749, 'st': 0.0105348, 'to': 0.0104127, 'nt': 0.0104125, 'ng': 0.0095301, 'se': 0.0093211, 'ha': 0.0092576, 'as': 0.008711, 'ou': 0.0087, 'io': 0.0083493, 'le': 0.0082925, 've': 0.0082528, 'co': 0.0079386, 'me': 0.0079301, 'de': 0.0076482, 'hi': 0.0076324, 'ri': 0.0072762, 'ro': 0.0072672, 'ic': 0.0069871, 'ne': 0.0069172, 'ea': 0.0068817, 'ra': 0.0068563, 'ce': 0.0065142, 'li': 0.0062435, 'ch': 0.0059777, 'll': 0.0057657, 'be': 0.0057628, 'ma': 0.0056527, 'si': 0.0055006, 'om': 0.0054626, 'ur': 0.0054275, 'ca': 0.0053816, 'el': 0.005303, 'ta': 0.0052989, 'la': 0.0052753, 'ns': 0.0050894, 'di': 0.0049297, 'fo': 0.0048775, 'ho': 0.004849, 'pe': 0.0047799, 'ec': 0.0047728, 'pr': 0.0047447, 'no': 0.0046457, 'ct': 0.0046097, 'us': 0.0045426, 'ac': 0.0044777, 'ot': 0.004421, 'il': 0.0043153, 'tr': 0.0042582, 'ly': 0.0042501, 'nc': 0.0041575, 'et': 0.0041261, 'ut': 0.0040515, 'ss': 0.0040508, 'so': 0.0039773, 'rs': 0.0039653, 'un': 0.0039441, 'lo': 0.0038688, 'wa': 0.0038534, 'ge': 0.0038519, 'ie': 0.0038465, 'wh': 0.0037879, 'ee': 0.0037761, 'wi': 0.0037442, 'em': 0.0037366, 'ad': 0.0036796, 'ol': 0.0036549, 'rt': 0.0036168, 'po': 0.0036137, 'we': 0.003609, 'na': 0.0034723, 'ul': 0.0034583, 'ni': 0.0033921, 'ts': 0.0033749, 'mo': 0.0033688, 'ow': 0.0033048, 'pa': 0.0032357, 'im': 0.0031776, 'mi': 0.0031769, 'ai': 0.0031645, 'sh': 0.0031524, 'ir': 0.0031517, 'su': 0.0031118, 'id': 0.002955, 'os': 0.0028997, 'iv': 0.0028785, 'ia': 0.0028628, 'am': 0.0028487, 'fi': 0.0028459, 'ci': 0.0028148, 'vi': 0.0026954, 'pl': 0.0026299, 'ig': 0.0025496, 'tu': 0.0025491, 'ev': 0.0025478, 'ld': 0.0025261, 'ry': 0.0024774, 'mp': 0.0023918, 'fe': 0.0023657, 'bl': 0.002334, 'ab': 0.0022979, 'gh': 0.002275, 'ty': 0.0022728, 'op': 0.0022391, 'wo': 0.0022175, 'sa': 0.0021802, 'ay': 0.0021736, 'ex': 0.0021404, 'ke': 0.0021377, 'fr': 0.0021319, 'oo': 0.0021026, 'av': 0.0020493, 'ag': 0.0020472, 'if': 0.0020326, 'ap': 0.0020285, 'gr': 0.0019678, 'od': 0.0019545, 'bo': 0.0019541, 'sp': 0.0019125, 'rd': 0.0018932, 'do': 0.0018823, 'uc': 0.0018765, 'bu': 0.0018494, 'ei': 0.0018335, 'ov': 0.0017809, 'by': 0.0017647, 'rm': 0.0017513, 'ep': 0.0017157, 'tt': 0.0017068, 'oc': 0.0016641, 'fa': 0.00164, 'ef': 0.0016273, 'cu': 0.0016261, 'rn': 0.0016036, 'sc': 0.0015475, 'gi': 0.0015164, 'da': 0.0015107, 'yo': 0.001499, 'cr': 0.0014946, 'cl': 0.0014901, 'du': 0.0014846, 'ga': 0.0014808, 'qu': 0.0014754, 'ue': 0.0014748, 'ff': 0.0014632, 'ba': 0.001462, 'ey': 0.0014375, 'ls': 0.0014151, 'va': 0.0013998, 'um': 0.0013838, 'pp': 0.0013655, 'ua': 0.0013633, 'up': 0.0013601, 'lu': 0.0013519, 'go': 0.0013213, 'ht': 0.0013019, 'ru': 0.0012833, 'ug': 0.0012791, 'ds': 0.0012626, 'lt': 0.0012364, 'pi': 0.0012309, 'rc': 0.0012139, 'rr': 0.0012074, 'eg': 0.0011954, 'au': 0.0011903, 'ck': 0.0011763, 'ew': 0.0011681, 'mu': 0.0011462, 'br': 0.0011156, 'bi': 0.001066, 'pt': 0.0010578, 'ak': 0.001047, 'pu': 0.0010454, 'ui': 0.0010115, 'rg': 0.0009977, 'ib': 0.000986, 'tl': 0.0009845, 'ny': 0.0009792, 'ki': 0.0009788, 'rk': 0.0009703, 'ys': 0.0009683, 'ob': 0.0009667, 'mm': 0.0009607, 'fu': 0.0009597, 'ph': 0.0009439, 'og': 0.0009402, 'ms': 0.0009283, 'ye': 0.0009267, 'ud': 0.000914, 'mb': 0.0009026, 'ip': 0.0008921, 'ub': 0.0008858, 'oi': 0.0008775, 'rl': 0.0008626, 'gu': 0.0008577, 'dr': 0.0008545, 'hr': 0.0008439, 'cc': 0.0008314, 'tw': 0.0008237, 'ft': 0.0008166, 'wn': 0.0007899, 'nu': 0.0007864, 'af': 0.0007421, 'hu': 0.0007369, 'nn': 0.0007276, 'eo': 0.000725, 'vo': 0.0007111, 'rv': 0.0006928, 'nf': 0.0006718, 'xp': 0.0006686, 'gn': 0.0006564, 'sm': 0.000652, 'fl': 0.000649, 'iz': 0.0006434, 'ok': 0.0006431, 'nl': 0.0006378, 'my': 0.0006219, 'gl': 0.0006064, 'aw': 0.0005992, 'ju': 0.000587, 'oa': 0.0005749, 'eq': 0.0005725, 'sy': 0.0005684, 'sl': 0.0005588, 'ps': 0.0005457, 'jo': 0.0005379, 'lf': 0.0005348, 'nv': 0.0005201, 'je': 0.0005189, 'nk': 0.0005161, 'kn': 0.0005144, 'gs': 0.0005119, 'dy': 0.0005042, 'hy': 0.0005009, 'ze': 0.0004973, 'ks': 0.0004751, 'xt': 0.0004666, 'bs': 0.0004583, 'ik': 0.0004291, 'dd': 0.0004275, 'cy': 0.0004172, 'rp': 0.0004162, 'sk': 0.0003946, 'xi': 0.0003942, 'oe': 0.0003863, 'oy': 0.0003618, 'ws': 0.0003508, 'lv': 0.0003491, 'dl': 0.0003234, 'rf': 0.0003226, 'eu': 0.0003115, 'dg': 0.00031, 'wr': 0.0003076, 'xa': 0.000296, 'yi': 0.0002882, 'nm': 0.0002775, 'eb': 0.0002707, 'rb': 0.0002671, 'tm': 0.0002648, 'xc': 0.0002646, 'eh': 0.0002632, 'tc': 0.0002614, 'gy': 0.0002594, 'ja': 0.0002586, 'hn': 0.0002576, 'yp': 0.0002491, 'za': 0.000249, 'gg': 0.0002475, 'ym': 0.0002367, 'sw': 0.0002353, 'bj': 0.0002322, 'lm': 0.0002302, 'cs': 0.0002282, 'ii': 0.0002278, 'ix': 0.0002203, 'xe': 0.0002179, 'oh': 0.0002135, 'lk': 0.0001971, 'dv': 0.0001905, 'lp': 0.0001903, 'ax': 0.0001884, 'ox': 0.0001858, 'uf': 0.0001853, 'dm': 0.0001818, 'iu': 0.0001741, 'sf': 0.0001716, 'bt': 0.000171, 'ka': 0.0001696, 'yt': 0.0001668, 'ek': 0.0001647, 'pm': 0.0001596, 'ya': 0.0001577, 'gt': 0.000154, 'wl': 0.0001522, 'rh': 0.0001511, 'yl': 0.0001476, 'hs': 0.0001468, 'ah': 0.0001364, 'yc': 0.000135, 'yn': 0.0001321, 'rw': 0.0001276, 'hm': 0.0001274, 'lw': 0.0001264, 'hl': 0.0001259, 'ae': 0.000124, 'zi': 0.0001212, 'az': 0.0001187, 'lc': 0.0001182, 'py': 0.0001176, 'aj': 0.0001175, 'iq': 0.000113, 'nj': 0.0001109, 'bb': 0.0001093, 'nh': 0.0001088, 'uo': 0.0001066, 'kl': 0.0001057, 'lr': 0.0001005, 'tn': 0.0001001, 'gm': 9.86e-05, 'sn': 9.17e-05, 'nr': 9.15e-05, 'fy': 9.1e-05, 'mn': 8.79e-05, 'dw': 8.16e-05, 'sb': 7.92e-05, 'yr': 7.79e-05, 'dn': 7.57e-05, 'sq': 7.44e-05, 'zo': 7.18e-05, 'oj': 6.98e-05, 'yd': 6.82e-05, 'lb': 6.69e-05, 'wt': 6.54e-05, 'lg': 6.09e-05, 'ko': 6.08e-05, 'np': 6.04e-05, 'sr': 5.99e-05, 'nq': 5.95e-05, 'ky': 5.95e-05, 'ln': 5.87e-05, 'nw': 5.8e-05, 'tf': 5.66e-05, 'fs': 5.51e-05, 'cq': 5.47e-05, 'dh': 5.44e-05, 'sd': 5.26e-05, 'vy': 4.9e-05, 'dj': 4.78e-05, 'hw': 4.77e-05, 'xu': 4.77e-05, 'ao': 4.63e-05, 'ml': 4.61e-05, 'uk': 4.6e-05, 'uy': 4.57e-05, 'ej': 4.55e-05, 'ez': 4.52e-05, 'hb': 4.39e-05, 'nz': 4.37e-05, 'nb': 4.34e-05, 'mc': 4.31e-05, 'yb': 4.3e-05, 'tp': 4.29e-05, 'xh': 4.17e-05, 'ux': 3.93e-05, 'tz': 3.85e-05, 'bv': 3.84e-05, 'mf': 3.82e-05, 'wd': 3.54e-05, 'oz': 3.47e-05, 'yw': 3.37e-05, 'kh': 3.19e-05, 'gd': 3.16e-05, 'bm': 3.13e-05, 'mr': 3.11e-05, 'ku': 3.03e-05, 'uv': 2.92e-05, 'dt': 2.9e-05, 'hd': 2.86e-05, 'aa': 2.83e-05, 'xx': 2.8e-05, 'df': 2.78e-05, 'db': 2.77e-05, 'ji': 2.76e-05, 'kr': 2.72e-05, 'xo': 2.7e-05, 'cm': 2.67e-05, 'zz': 2.66e-05, 'nx': 2.62e-05, 'yg': 2.59e-05, 'xy': 2.58e-05, 'kg': 2.56e-05, 'tb': 2.54e-05, 'dc': 2.52e-05, 'bd': 2.47e-05, 'sg': 2.47e-05, 'wy': 2.42e-05, 'zy': 2.36e-05, 'aq': 2.24e-05, 'hf': 2.24e-05, 'cd': 2.23e-05, 'vu': 2.21e-05, 'kw': 2.18e-05, 'zu': 2.15e-05, 'bn': 2.09e-05, 'ih': 2.09e-05, 'tg': 1.97e-05, 'xv': 1.95e-05, 'uz': 1.91e-05, 'bc': 1.89e-05, 'xf': 1.86e-05, 'yz': 1.81e-05, 'km': 1.79e-05, 'dp': 1.73e-05, 'lh': 1.62e-05, 'wf': 1.61e-05, 'kf': 1.59e-05, 'pf': 1.45e-05, 'cf': 1.41e-05, 'mt': 1.37e-05, 'yu': 1.33e-05, 'cp': 1.31e-05, 'pb': 1.31e-05, 'td': 1.3e-05, 'zl': 1.26e-05, 'sv': 1.24e-05, 'hc': 1.23e-05, 'mg': 1.22e-05, 'pw': 1.21e-05, 'gf': 1.2e-05, 'pd': 1.2e-05, 'pn': 1.19e-05, 'pc': 1.18e-05, 'rx': 1.17e-05, 'tv': 1.16e-05, 'ij': 1.11e-05, 'wm': 1.09e-05, 'uh': 1.07e-05, 'wk': 1.07e-05, 'wb': 1.06e-05, 'bh': 1.06e-05, 'oq': 1.04e-05, 'kt': 1.03e-05, 'rq': 1e-05, 'kb': 9e-06, 'cg': 8.9e-06, 'vr': 8.8e-06, 'cn': 8.6e-06, 'pk': 8.2e-06, 'uu': 7.8e-06, 'yf': 7.5e-06, 'wp': 7.4e-06, 'cz': 7.3e-06, 'kp': 7.3e-06, 'dq': 7.1e-06, 'wu': 7e-06, 'fm': 6.9e-06, 'wc': 6.7e-06, 'md': 6.7e-06, 'kd': 6.7e-06, 'zh': 6.7e-06, 'gw': 6.5e-06, 'rz': 6.4e-06, 'cb': 6.3e-06, 'iw': 6.2e-06, 'xl': 5.9e-06, 'hp': 5.9e-06, 'mw': 5.8e-06, 'vs': 5.8e-06, 'fc': 5.8e-06, 'rj': 5.5e-06, 'bp': 5.5e-06, 'mh': 5.3e-06, 'hh': 5.2e-06, 'yh': 5.2e-06, 'uj': 5.2e-06, 'fg': 5.1e-06, 'fd': 5e-06, 'gb': 4.9e-06, 'pg': 4.7e-06, 'tk': 4.6e-06, 'kk': 4.5e-06, 'hq': 4.2e-06, 'fn': 4.2e-06, 'lz': 4.2e-06, 'vl': 4.1e-06, 'gp': 4.1e-06, 'hz': 3.8e-06, 'dk': 3.4e-06, 'yk': 3.3e-06, 'qi': 3.2e-06, 'lx': 3.1e-06, 'vd': 3e-06, 'zs': 3e-06, 'bw': 3e-06, 'xq': 2.9e-06, 'mv': 2.9e-06, 'uw': 2.8e-06, 'hg': 2.8e-06, 'fb': 2.7e-06, 'sj': 2.7e-06, 'ww': 2.6e-06, 'gk': 2.6e-06, 'uq': 2.6e-06, 'bg': 2.6e-06, 'sz': 2.5e-06, 'jr': 2.4e-06, 'ql': 2.4e-06, 'zt': 2.4e-06, 'hk': 2.3e-06, 'vc': 2.3e-06, 'xm': 2.3e-06, 'gc': 2.3e-06, 'fw': 2.3e-06, 'pz': 2.3e-06, 'kc': 2.2e-06, 'hv': 2.2e-06, 'xw': 2.2e-06, 'zw': 2.2e-06, 'fp': 2.2e-06, 'iy': 2.2e-06, 'pv': 2.2e-06, 'vt': 2.2e-06, 'jp': 2.2e-06, 'cv': 2.1e-06, 'zb': 2.1e-06, 'vp': 2e-06, 'zr': 1.9e-06, 'fh': 1.8e-06, 'yv': 1.8e-06, 'zg': 1.7e-06, 'zm': 1.7e-06, 'zv': 1.6e-06, 'qs': 1.6e-06, 'kv': 1.6e-06, 'vn': 1.5e-06, 'zn': 1.5e-06, 'qa': 1.5e-06, 'yx': 1.5e-06, 'jn': 1.5e-06, 'bf': 1.5e-06, 'mk': 1.4e-06, 'cw': 1.4e-06, 'jm': 1.3e-06, 'lq': 1.3e-06, 'jh': 1.3e-06, 'kj': 1.2e-06, 'jc': 1.2e-06, 'gz': 1.2e-06, 'js': 1.2e-06, 'tx': 1.2e-06, 'fk': 1.2e-06, 'jl': 1.1e-06, 'vm': 1.1e-06, 'lj': 1.1e-06, 'tj': 1.1e-06, 'jj': 1.1e-06, 'cj': 1.1e-06, 'vg': 1e-06, 'mj': 1e-06, 'jt': 1e-06, 'pj': 1e-06, 'wg': 1e-06, 'vh': 1e-06, 'bk': 9e-07, 'vv': 9e-07, 'jd': 9e-07, 'tq': 9e-07, 'vb': 9e-07, 'jf': 9e-07, 'dz': 8e-07, 'xb': 8e-07, 'jb': 8e-07, 'zc': 7e-07, 'fj': 7e-07, 'yy': 7e-07, 'qn': 7e-07, 'xs': 6e-07, 'qr': 6e-07, 'jk': 6e-07, 'jv': 6e-07, 'qq': 6e-07, 'xn': 6e-07, 'vf': 5e-07, 'px': 5e-07, 'zd': 5e-07, 'qt': 5e-07, 'zp': 5e-07, 'qo': 5e-07, 'dx': 5e-07, 'hj': 5e-07, 'gv': 4e-07, 'jw': 4e-07, 'qc': 4e-07, 'jy': 4e-07, 'gj': 4e-07, 'qb': 4e-07, 'pq': 4e-07, 'jg': 4e-07, 'bz': 4e-07, 'mx': 4e-07, 'qm': 4e-07, 'mz': 3e-07, 'qf': 3e-07, 'wj': 3e-07, 'zq': 3e-07, 'xr': 3e-07, 'zk': 3e-07, 'cx': 3e-07, 'fx': 3e-07, 'fv': 3e-07, 'bx': 3e-07, 'vw': 3e-07, 'vj': 3e-07, 'mq': 3e-07, 'qv': 2e-07, 'zf': 2e-07, 'qe': 2e-07, 'yj': 2e-07, 'gx': 2e-07, 'kx': 2e-07, 'xg': 2e-07, 'qd': 2e-07, 'xj': 2e-07, 'sx': 2e-07, 'vz': 2e-07, 'vx': 2e-07, 'wv': 1e-07, 'yq': 1e-07, 'bq': 1e-07, 'gq': 1e-07, 'vk': 1e-07, 'zj': 1e-07, 'xk': 1e-07, 'qp': 1e-07, 'hx': 1e-07, 'fz': 1e-07, 'qh': 1e-07, 'qj': 1e-07, 'jz': 1e-07, 'vq': 1e-07, 'kq': 1e-07, 'xd': 1e-07, 'qw': 1e-07, 'jx': 1e-07, 'qx': 1e-07, 'kz': 1e-07, 'wx': 1e-07, 'fq': 1e-07, 'xz': 0.0, 'zx': 0.0, 'jq': 0.0, 'qg': 0.0, 'qk': 0.0, 'qy': 0.0, 'qz': 0.0, 'wq': 0.0, 'wz': 0.0}

def trigrams(text):
    output = {}
    textLen = len(text)

    for i in range(0, textLen - 2):
        trigram = f"{text[i]}{text[i+1]}{text[i+2]}"
        try:
            output[trigram] += 1
        except:
            output[trigram] = 1

    output = dict(sorted(output.items(), key=lambda item: item[1], reverse=True))
    trigrams = list(output.keys())
    frequencies = list(output.values())

    print(trigrams)
    print(frequencies)

    return trigrams[0:16], frequencies[0:16]

def frequency(text, alphabetLen = 26, decimalise = False):
    output = [0 for i in range(0, alphabetLen)]
    textLen = len(text)
    for char in text:
        output[ord(char)-97] += 1
    if decimalise:
        output = applyToList(lambda x: x / textLen, output)
    return output

def applyToList(func, array):
    return [func(i) for i in array]

def calculateIC(text, alphabetLen=26):
    textFreq = frequency(text, alphabetLen)
    textLen = len(text)
    
    #print(textFreq, textLen)

    sum = 0 
    for freq in textFreq:
        sum += freq * (freq - 1)

    IC = sum / (textLen * (textLen - 1))
    return IC

def splitCosets(keyLength, text):
    output = [[] for i in range(0,keyLength)]

    pos = 0
    for char in text:
        output[pos % keyLength].append(char)
        pos += 1

    for i in range(0,len(output)):
        output[i] = "".join(output[i])

    return output

def bigramFrequency(text, decimalize = 0):
    output = {}
    for i in range(len(text)-1):
        bigram = f"{text[i]}{text[i+1]}"
        try:
            output[bigram] += 1
        except:
            output[bigram] = 1
    if decimalize:
        for key, value in output.items(): print(key, value)
        output = {bgram : freq/(len(text) - 1) for bgram, freq in output.items()}
    return output

def chiSquared(text):
    frequencies = frequency(text)
    textLen = len(text)

    chi2 = 0
    for i in range(26):
        expectedFreq = textLen * ENG_LETTER_FREQ[i]
        chi2 += ((frequencies[i] - expectedFreq)**2) / expectedFreq
    return chi2


def engFitness(text):
    frequencies = frequency(text, decimalise=True)
    bigramFrequencies = bigramFrequency(text, decimalize=True)
    print(frequencies)
    fitness = 0
    for i in range(len(ALPHABET)):
        sum = 0
        letterA = ALPHABET[i]
        for letterB in ALPHABET:
            try:
                sum += abs(BIGRAM_FREQ[letterA+letterB] - bigramFrequencies[letterA+letterB])
            except:
                bigramFrequencies[letterA+letterB] = 0
                sum += abs(BIGRAM_FREQ[letterA+letterB] - bigramFrequencies[letterA+letterB])
        sum += abs(ENG_LETTER_FREQ[i] - frequencies[i])
        fitness += sum
    fitness /= 4
    print(fitness)
    fitness = 1 - fitness
    print(fitness)
    fitness **= 8
    print(fitness)
    return fitness
